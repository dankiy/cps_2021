\documentclass[a4paper]{article}
\usepackage{pmstyle}

\begin{document}
\hyphenation{СПбГУ}

\udk{УДК 004.93}

\author{Кульминский~Д.\:П., Ефимов~В.\:В.}

\title{Semi-supervised сегментация\\ с использованием нейросетей \\ в задаче оценки кондиционности керна}


\renewcommand{\thefootnote}{ }
{\footnotetext{{\it Кульминский Данил Петрович} -- студент, Санкт-Петербургский государственный университет; e-mail: st064144@student.spbu.ru, тел.: +7(922)194-01-88}}
{\footnotetext{{\it Ефимов Владислав Владимирович} -- студент, Санкт-Петербургский государственный университет; e-mail: st073936@student.spbu.ru, тел.: +7(911)112-58-89}}

\maketitle

\recdotz{Гришкиным~В.\:М.}

\razdel{Введение}
\podrazdel{Описание задачи}
Керн --- образец горной породы цилиндрической формы. По такому образцу можно получить информацию о геологическом строении недр, вещественном составе горных пород, наличии или отсутствии в них углеводородов. Однако, прежде чем транспортировать образец в кернохранилище или лабораторию, необходимо точечно оценить кондиционность керна, т.е. его пригодность для взятия пробы и дальнейшего лабораторного анализа. Некондиционными считаются участки с обилием трещин техногенного (получаются при извлечении из скважины или транспортировке) или естественного происхождения (свойство самой породы) или наличием крупных разломов.  Эти участки не участвуют в последующих исследованиях. Соответственно, задача заключалась в  разработатке инструмента, выполняющего семантическую бинарную сегментацию кондиционности горной породы, т.е. присваивающего каждому пикселю принадлежность к одному из классов: <<кондиционный>> или <<некондиционный>>. 
\podrazdel{Обучающая выборка}
Традиционно в задаче семантической сегментации в качестве обучающей выборки используются пары из оригинальных изображений и масок. Последние представляют собой изображение, совпадающее с оригиналом по размерности, каждый пиксель которого имеет метку одного из классов, т.е. имеет место переход из какого-либо цветового пространства во множество меток классов. Обычно маски являются результатом ручной разметки специалистов предметной области. Объем выборок из таких пар варьируется от нескольких сотен до нескольких тысяч примеров. Ввиду того, что предоставить несколько тысяч масок с достаточно чувствительной разметкой кондиционных и некондиционных сегментов за разумное время не представлялось возможным,  вынужденной мерой стало использование вместо детальной попиксельной разметки более грубой площадной, представляющей из себя обобщенную оценку качества на том или ином крупном сегменте породы.

\razdel{Описание подхода}
 
Предложенный подход состоял из следующих этапов:
\NList{
	\ITEM по исходному изображению составлялась маска классов пород с использованием обученного классификатора, применяемого на окнах, и SS-CAM (Smooth Score Class Activation Map) \cite{sscam} обученного классификатора кондиционности;
	\ITEM маска SS-CAM бинаризовалась применением пороговой функции (трешхолда) попиксельно в зависимости от классов пород;
	\ITEM на полученных <<грубых>> бинарных масках сегментации обучалась модель семантической сегментации Unet, позволяющая получить финальный результат сегментации в один этап.
}

\Figure{1.0\textwidth}{images/Core_pipeline.eps}{Схема этапов обучения алгоритма\label{Core_pipeline}}

\podrazdel{Классификатор пород} Задачей классификатора пород было определять следующие классы: <<алевролит>>, <<песчаник>>, <<переслаивание пород>>, <<аргиллит>>. В качестве основы была использована предобученная нейросетевая модель efficientnet-b3 \cite{effnet}. 

Предобработка данных для обучения состояла из следующих этапов:
\NList{
	\ITEM пропорциональное приведение исходного изображения к фиксированной ширине в 256 пикселей; 
	\ITEM выбор в качестве сэмплов прямоугольных областей изображения высотой в 512 пикселей и шириной в 256, 50\% площади которых принадлежат одному классу породы;
	\ITEM замена черным пикселей, не принадлежащих к целевому классу, т.е. тому, который занимает 50\% и более от всей площади сэмпла.
}

На полученном множестве сэмплов efficientnet-b3 дообучалась с использованием оптимизатора AdamW \cite{adamw} и кросс-энтропии в качестве функции потерь.

В силу специфики предметной области переиспользование моделей на изображениях иного масштаба крайне нежелательно. Причиной тому является значимость размера вкраплений в качестве визуального признака при определении породы литологических образцов.

В связи с этим в процессе использования модели исходные изображения аналогично предобработке на этапе обучения приводились к ширине в 256 пикселей. Далее изображения разбивались по вертикали на окна высотой в 512 пикселей с пересечением в 60\%. Полученные окна использовались в качестве входных данных для модели, на пересечениях вектор вероятностей классов усреднялся. 

\podrazdel{Бинарный классификатор кондиционности} Поскольку точность разметки не позволяла явно обучить на ней сегментатор кондиционности, для <<грубой>> сегментации использовалась SSCAM первого сверточного слоя классификатора, она показывала значимость каждого пикселя в задаче определения класса <<кондиционный>> или <<некондиционный>>. 

Предобработка изображений на этапе обучения была аналогична описанной для классификатора пород. В качестве классификатора использовалась обученная с нуля архитектура resnet-18 \cite{resnet} с использованием оптимизатора Adam и бинарной кросс-энтропией в качестве функции потерь.

На этапе использования SSCAM классификатора исходные изображения так же приводились к ширине в 256 пикселей. Далее изображения разбивались на окна высотой  в 512 пикселей и шириной в 256 с наложением в 60\% как по горизонтали, так и по вертикали. Для устранения артефактов крайние 20 пикселей SSCAM не использовались, для остальных пикселей на пересечениях окон значения соседних SSCAM усреднялись. Для получения бинарной маски сегментации использовался установленный в зависимости от класса породы порог (трешхолд). На полученной бинарной маске удалялись все сегменты с площадью менее 400 пикселей.

\podrazdel{UNet}

\razdel{Анализ результатов}

Предложенный подход позволил добиться решения высокой точности в задаче сегментации без соответствующей разметки. Результат был достигнут благодаря использованию всего объема доступных данных, в том числе разметки пород и информации от экспертов предметной области, позволившей подобрать пороговые значения для алгоритма на первом этапе <<грубой>> сегментации.

Использование Unet для построения финального решения существенно повысило скорость обработки изображений.

\razdel{Заключение}


\begin{thebibliography}{40}

\bibitem{sscam} Haofan Wang, Rakshit Naidu, Joy Michael, Soumya Snigdha Kundu SS-CAM: Smoothed Score-CAM for Sharper Visual Feature Localization // arXiv preprint arXiv:2006.14255. 2020.
\bibitem{effnet} Mingxing Tan, Quoc V. Le EfficientNet: Rethinking Model Scaling for Convolutional Neural Networks // arXiv preprint arXiv:1905.11946. 2020.
\bibitem{adamw} Ilya Loshchilov, Frank Hutter Decoupled Weight Decay Regularization // arXiv preprint arXiv:1711.05101. 2019.
\bibitem{resnet} Kaiming He, Xiangyu Zhang, Shaoqing Ren, Jian Sun Deep Residual Learning for Image Recognition // arXiv preprint arXiv:1512.03385. 2015.

\end{thebibliography}
\end{document}